{
  "version": 3,
  "sources": ["../../../../node_modules/Router/Router.js"],
  "sourcesContent": ["'use strict'\r\n/**\r\n* Simplistic Routing Module\r\n* NodeJS Regular expression routing.\r\n* ---\r\n* Argochamber Interactive 2016\r\n* by Pablo 'sigmasoldier' Blanco CeldrÃ¡n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\r\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\r\nIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\r\nDAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\r\nARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\r\nDEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n * Standard chaining Route.\r\n * The callback is called as is.\r\n */\r\nclass Route {\r\n\r\n  constructor(regex, allow, callback){\r\n    this.allowedMethods = allow;\r\n    this.callback = callback;\r\n    if (typeof regex === \"string\") {\r\n      this.regex = RegExp(`^${regex}$`);\r\n    } else if (regex instanceof RegExp){\r\n      this.regex = regex;\r\n    } else {\r\n      throw new Error(\"The route must be a regular expression or a string!\");\r\n    }\r\n  }\r\n\r\n  fire(req, res) {\r\n    const m = req.url.match(this.regex);\r\n    this.callback(req, res, m);\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * This is used when you want to hook up a class method or an external function\r\n * with this (Basically the hook guesses what to return in the response using\r\n * what the function/method returns).\r\n */\r\nclass Hook extends Route {\r\n\r\n  constructor(regex, allow, callback){\r\n    super(regex, allow, callback);\r\n  }\r\n\r\n  /**\r\n   * Processes a return from a hook.\r\n   * @param {Object} r Response.\r\n   * @param {Request} req\r\n   * @param {Response} res\r\n   */\r\n  static processReturn(r, req, res){\r\n    if (typeof r === 'object'){\r\n      let code = r.code || 200;\r\n      let head = r.head || {'Content-Type': 'plain/text'};\r\n      let data = r.data;\r\n      let type = typeof data;\r\n      if (type === 'undefined') {\r\n        res.writeHead(code, head);\r\n        res.end();\r\n      } else if (type === 'object') {\r\n        head['Content-Type'] = 'application/json';\r\n        res.writeHead(code, head);\r\n        res.write(JSON.stringify(data));\r\n        res.end();\r\n      } else {\r\n        res.writeHead(code, head);\r\n        res.write(data);\r\n        res.end();\r\n      }\r\n    } else {\r\n      res.end(r);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fires the hook.\r\n   * @param {Request} req\r\n   * @param {Response} res\r\n   */\r\n  fire(req, res) {\r\n    const m = req.url.match(this.regex);\r\n    const r = this.callback(req, m);\r\n    if (r instanceof Promise) {\r\n      r.then((data) => {\r\n        Hook.processReturn(data, req, res);\r\n      });\r\n    } else {\r\n      Hook.processReturn(r, req, res);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * The router module grants you a routing system using regexp.\r\n * Is like using if ... else if ... else with regexp.\r\n */\r\nclass Router {\r\n\r\n constructor(){\r\n   this.__routes = [];\r\n   this.__final = () => {};\r\n }\r\n\r\n /**\r\n  * Called when the router wants to handle an incoming connection.\r\n  * If a route is matched, the callback is fired. As this simple.\r\n  * @param {RegExp} regex\r\n  * @param {Array} optMode Optional\r\n  * @param {Function} callback\r\n  */\r\n when(regex, optMode, callback) {\r\n   if (typeof callback === 'undefined') {\r\n     let route = new Route(regex, [], optMode);\r\n     this.__routes.push(route);\r\n     return this;\r\n   } else {\r\n     let route = new Route(regex, optMode, callback);\r\n     this.__routes.push(route);\r\n     return this;\r\n   }\r\n };\r\n\r\n /**\r\n  * This will register a new hook.\r\n  * @param {RegExp} regex\r\n  * @param {Array} optMode Optional\r\n  * @param {Function} callback\r\n  */\r\n hook(regex, optMode, callback) {\r\n   if (typeof callback === 'undefined') {\r\n     let route = new Hook(regex, [], optMode);\r\n     this.__routes.push(route);\r\n     return this;\r\n   } else {\r\n     let route = new Hook(regex, optMode, callback);\r\n     this.__routes.push(route);\r\n     return this;\r\n   }\r\n };\r\n\r\n /**\r\n  * Syntactic sugar for Router.hook(...);\r\n  * @param {RegExp} r\r\n  * @param {Array} o Optional\r\n  * @param {Function} c\r\n  */\r\n $(r, o, c){\r\n   this.hook(r, o, c);\r\n }\r\n\r\n /**\r\n  * This is called if noone of the when routes has been matched.\r\n  * @param {Function} handler\r\n  */\r\n finally(handler) {\r\n   this.__final = handler;\r\n };\r\n\r\n /**\r\n  * Sugar for finally.\r\n  * @param {Function} handler\r\n  */\r\n final(handler){\r\n   this.finally(handler);\r\n }\r\n\r\n\r\n /**\r\n  * This applies all the registered routes to the incoming request.\r\n  * @param {Request} req\r\n  * @param {Response} res\r\n  */\r\n  listen(req, res) {\r\n    let m = false;\r\n    this.__routes.forEach((r) => {\r\n      if (!m) {\r\n        let test = r.regex.test(req.url);\r\n        let noSize = r.allowedMethods.length === 0;\r\n        if (test && noSize){\r\n          m = true;\r\n          r.fire(req, res);\r\n        } else if (test && r.allowedMethods.some((m) => m === req.method)) {\r\n          m = true;\r\n          r.fire(req, res);\r\n        }\r\n      }\r\n    });\r\n    if (!m) {\r\n      this.__final(req, res);\r\n    }\r\n  }\r\n\r\n};\r\n\r\n//Expose the module.\r\nmodule.exports = new Router();\r\n"],
  "mappings": "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",
  "names": ["m"]
}
